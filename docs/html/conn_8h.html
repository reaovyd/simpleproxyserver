<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>simpleproxyserver: include/conn.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">simpleproxyserver
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">conn.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This interface is the specification for the <code><a class="el" href="structConnectionPool.html" title="This is the object that represents the connection pool.">ConnectionPool</a></code> object which handles all of the current connections that the proxy server is handling.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;sys/select.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for conn.h:</div>
<div class="dyncontent">
<div class="center"><img src="conn_8h__incl.png" border="0" usemap="#ainclude_2conn_8h" alt=""/></div>
<map name="ainclude_2conn_8h" id="ainclude_2conn_8h">
<area shape="rect" title="This interface is the specification for the ConnectionPool object which handles all of the current co..." alt="" coords="5,5,121,32"/>
<area shape="rect" title=" " alt="" coords="14,80,113,107"/>
</map>
</div>
</div>
<p><a href="conn_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a65bb3d664e3b34ea8775d5fd59ca3c60"><td class="memItemLeft" align="right" valign="top"><a id="a65bb3d664e3b34ea8775d5fd59ca3c60"></a>
typedef struct connectionPool&#160;</td><td class="memItemRight" valign="bottom"><b>ConnectionPool</b></td></tr>
<tr class="separator:a65bb3d664e3b34ea8775d5fd59ca3c60"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0340036eb0c84ec60969fe890b94ae81"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structConnectionPool.html">ConnectionPool</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conn_8h.html#a0340036eb0c84ec60969fe890b94ae81">conn_pool_init</a> (void)</td></tr>
<tr class="memdesc:a0340036eb0c84ec60969fe890b94ae81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a new connection pool to handle user connections.  <a href="conn_8h.html#a0340036eb0c84ec60969fe890b94ae81">More...</a><br /></td></tr>
<tr class="separator:a0340036eb0c84ec60969fe890b94ae81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a827144fb78571fe9a99a0e700742293e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conn_8h.html#a827144fb78571fe9a99a0e700742293e">conn_insert_fd</a> (<a class="el" href="structConnectionPool.html">ConnectionPool</a> *conn_pool, int fd)</td></tr>
<tr class="memdesc:a827144fb78571fe9a99a0e700742293e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inserts a new connection into the connection pool.  <a href="conn_8h.html#a827144fb78571fe9a99a0e700742293e">More...</a><br /></td></tr>
<tr class="separator:a827144fb78571fe9a99a0e700742293e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a686ebc70a031da05e49cc41194cba212"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conn_8h.html#a686ebc70a031da05e49cc41194cba212">conn_remove_fd</a> (<a class="el" href="structConnectionPool.html">ConnectionPool</a> *conn_pool, int fd)</td></tr>
<tr class="memdesc:a686ebc70a031da05e49cc41194cba212"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes a connection from the connection pool.  <a href="conn_8h.html#a686ebc70a031da05e49cc41194cba212">More...</a><br /></td></tr>
<tr class="separator:a686ebc70a031da05e49cc41194cba212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2fdf6d8b120978ce2e0e99d96957abb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conn_8h.html#ae2fdf6d8b120978ce2e0e99d96957abb">conn_destroy</a> (<a class="el" href="structConnectionPool.html">ConnectionPool</a> *conn_pool)</td></tr>
<tr class="memdesc:ae2fdf6d8b120978ce2e0e99d96957abb"><td class="mdescLeft">&#160;</td><td class="mdescRight">TODO honestly fix this and make it mroe clear.  <a href="conn_8h.html#ae2fdf6d8b120978ce2e0e99d96957abb">More...</a><br /></td></tr>
<tr class="separator:ae2fdf6d8b120978ce2e0e99d96957abb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab42b966daaa88813b48d8448b06a3c7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conn_8h.html#aab42b966daaa88813b48d8448b06a3c7">conn_copy_fd_sets</a> (<a class="el" href="structConnectionPool.html">ConnectionPool</a> *conn_pool, fd_set *rd_set_cpy, fd_set *wr_set_cpy, int *nfds)</td></tr>
<tr class="memdesc:aab42b966daaa88813b48d8448b06a3c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes as argument a pointer to a connection pool.  <a href="conn_8h.html#aab42b966daaa88813b48d8448b06a3c7">More...</a><br /></td></tr>
<tr class="separator:aab42b966daaa88813b48d8448b06a3c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b500bf2c8f0f7c2648655be64fac01b"><td class="memItemLeft" align="right" valign="top"><a id="a8b500bf2c8f0f7c2648655be64fac01b"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>conn_get_pool_size</b> (<a class="el" href="structConnectionPool.html">ConnectionPool</a> *conn_pool)</td></tr>
<tr class="separator:a8b500bf2c8f0f7c2648655be64fac01b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This interface is the specification for the <code><a class="el" href="structConnectionPool.html" title="This is the object that represents the connection pool.">ConnectionPool</a></code> object which handles all of the current connections that the proxy server is handling. </p>
<p>It is important to note that each function occurs atomically in terms of multiple threads calling the functions. This is done through a simple mutex that locks before the function runs and after the function runs so that data is consistent and synchronized across each thread. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aab42b966daaa88813b48d8448b06a3c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab42b966daaa88813b48d8448b06a3c7">&#9670;&nbsp;</a></span>conn_copy_fd_sets()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int conn_copy_fd_sets </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structConnectionPool.html">ConnectionPool</a> *&#160;</td>
          <td class="paramname"><em>conn_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fd_set *&#160;</td>
          <td class="paramname"><em>rd_set_cpy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fd_set *&#160;</td>
          <td class="paramname"><em>wr_set_cpy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nfds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes as argument a pointer to a connection pool. </p>
<p>The caller specifies the argument rd_set_cpy (which is the read set that will be passed to select(2)) and wr_set_cpy (which is the write set that will be passed to select), and the connection pool's fd sets are copied over to the respective copy set. The function fails if either of the pointers to the sets point to a <code>NULL</code> reference or if the connection pool points to a <code>NULL</code> value. This function also takes in a <code>nfds</code> argument which is a pointer to an integer value. The max file descriptor value is copied over to that pointer. If <code>nfds</code> points to a <code>NULL</code> value, then the function call fails.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn_pool</td><td>A pointer to a connection pool that holds all of the current connections </td></tr>
    <tr><td class="paramname">rd_set_cpy</td><td>The read set passed by the caller in which the function copies the pool's read set to rd_set_cpy </td></tr>
    <tr><td class="paramname">wr_set_cpy</td><td>The write set passed by the caller in which the function copies the pool's write set to wr_set_cpy </td></tr>
    <tr><td class="paramname">nfds</td><td>The pointer to an integer that will have its value to that address replaced by the current max file descriptor value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the copying succeeds. Otherwise, -1. </dd></dl>

</div>
</div>
<a id="ae2fdf6d8b120978ce2e0e99d96957abb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2fdf6d8b120978ce2e0e99d96957abb">&#9670;&nbsp;</a></span>conn_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void conn_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structConnectionPool.html">ConnectionPool</a> *&#160;</td>
          <td class="paramname"><em>conn_pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>TODO honestly fix this and make it mroe clear. </p>
<p>This function shuts down any of the connections that are still in the pool. The function invokes the shutdown(2) to shut down any socket file descriptors that belong to that connection. In addition, calling this function will free the block being pointed to by conn_pool.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn_pool</td><td>A pointer to a connection pool that holds all of the current connections </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a827144fb78571fe9a99a0e700742293e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a827144fb78571fe9a99a0e700742293e">&#9670;&nbsp;</a></span>conn_insert_fd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int conn_insert_fd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structConnectionPool.html">ConnectionPool</a> *&#160;</td>
          <td class="paramname"><em>conn_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inserts a new connection into the connection pool. </p>
<p>The new connection is described by the file descriptor fd and the connection pool is represented as conn_pool. The function fails if including this new connection exceeds the maximum number of possible connections that select(2) can handle. In this case, it is FD_SETSIZE (which is defined to be 1024 as specified in select(2)) connections. The function also fails if the conn_pool pointer points to a <code>NULL</code> address. If the connection pool holds the current fd already, nothing is done, but the call succeeds.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn_pool</td><td>A pointer to a connection pool that holds all of the current connections </td></tr>
    <tr><td class="paramname">fd</td><td>The socket file descriptor that represents the new connection </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the new connection has been succesfully inserted into the pool. Otherwise, it returns -1. </dd></dl>

</div>
</div>
<a id="a0340036eb0c84ec60969fe890b94ae81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0340036eb0c84ec60969fe890b94ae81">&#9670;&nbsp;</a></span>conn_pool_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structConnectionPool.html">ConnectionPool</a>* conn_pool_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes a new connection pool to handle user connections. </p>
<p>The caller should be using a function like <code>select(2)</code> to handle the pool. The initialiation fails if memory allocation for the <a class="el" href="structConnectionPool.html" title="This is the object that represents the connection pool.">ConnectionPool</a> fails.</p>
<dl class="section return"><dt>Returns</dt><dd>On success, it returns a pointer to the new connection pool. Otherwise, on failure, it returns NULL. </dd></dl>

</div>
</div>
<a id="a686ebc70a031da05e49cc41194cba212"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a686ebc70a031da05e49cc41194cba212">&#9670;&nbsp;</a></span>conn_remove_fd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int conn_remove_fd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structConnectionPool.html">ConnectionPool</a> *&#160;</td>
          <td class="paramname"><em>conn_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes a connection from the connection pool. </p>
<p>The connection that gets removed is specified by the file descriptor fd. In addition, it also fails if conn_pool is <code>NULL</code>. If fd is not in the pool, then the call still succeeds. The call, however, does fail if the pool size is currently less than or equal to 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn_pool</td><td>A pointer to a connection pool that holds all of the current connections </td></tr>
    <tr><td class="paramname">fd</td><td>The socket file descriptor that represents the connection to remove </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the new connection has been succesfully removed from the pool. Otherwise, it returns -1. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
